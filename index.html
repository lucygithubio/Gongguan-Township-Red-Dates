<H1>公館鄉紅棗品牌管理家</H1>
<!--
  主題：公館紅棗產業推廣網站
  設計風格：自然鄉村科技感 (Natural Rural Tech-feel)，紅棗暖色調。
  結構：單頁 HTML，使用 Tailwind CSS 進行響應式布局。
  核心區塊：標題區/API狀態、活動選單、品牌故事卡片、農園地圖。
  互動功能：API Key 驗證、活動篩選、故事卡片定位、AI/影片按鈕模擬。
-->
<script src="https://cdn.tailwindcss.com"></script>
<style>
  /* 載入 Inter 字體並設定柔和、自然的背景 */
  body {
    font-family: 'Inter', sans-serif;
    /* 柔和的淺米色/大地色漸層背景 */
    background-color: #f7f7f0;
    background-image: linear-gradient(135deg, #fefefe 0%, #f1f5f9 100%);
    color: #1e293b; /* 深色文字 */
    min-height: 100vh;
    padding: 1.5rem 1rem;
  }

  /* 核心卡片樣式：柔和陰影、圓角邊框、溫暖色調 */
  .rural-tech-card {
    background-color: #ffffff; /* 白色背景 */
    border: 1px solid #e5e5e5; /* 淺灰邊框 */
    border-radius: 1.5rem; /* 更大的圓角 */
    box-shadow: 0 10px 30px -5px rgba(0, 0, 0, 0.08), 0 5px 15px -5px rgba(0, 0, 0, 0.04); /* 柔和深陰影 */
    transition: all 0.3s ease;
  }

  .rural-tech-card:hover {
    box-shadow: 0 15px 35px -8px rgba(214, 40, 40, 0.2), 0 8px 20px -5px rgba(214, 40, 40, 0.1); /* 紅棗紅的柔和陰影 */
    transform: translateY(-2px);
  }

  /* 紅棗色調 */
  .jujube-red {
    background-color: #D62828; /* 深紅棗色 */
  }
  .jujube-text {
    color: #D62828;
  }
  .jujube-gradient {
    background-image: linear-gradient(to right, #D62828, #E76F51); /* 紅棗漸層 */
  }

  /* 確保卡片區可以垂直滾動 */
  #story-cards {
    max-height: calc(100vh - 430px); /* 調整高度以容納 API 設定區 */
    overflow-y: auto;
  }

  /* 滾動條樣式 */
  #story-cards::-webkit-scrollbar {
    width: 6px;
  }

  #story-cards::-webkit-scrollbar-thumb {
    background: #fca5a5; /* 淺紅棗色 */
    border-radius: 10px;
  }

  /* 地圖定位點動畫 */
  .map-pin-animate {
    animation: bounce-pin 1.5s infinite;
  }

  @keyframes bounce-pin {
    0%, 20%, 50%, 80%, 100% {
      transform: translateY(0);
    }
    40% {
      transform: translateY(-30px);
    }
    60% {
      transform: translateY(-15px);
    }
  }
</style>

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- 整個網站的中央容器 (container) -->
<div id="main-container" class="max-w-7xl mx-auto p-4 md:p-8">

  <!-- 標題區 (Header/Title) -->
  <header class="rural-tech-card mb-8 p-6 flex flex-col md:flex-row justify-between items-start md:items-center bg-white">
    <div class="text-3xl md:text-4xl font-extrabold tracking-tight mb-3 md:mb-0">
      <span class="jujube-text">🍒 棗紅公館</span>：數位轉型儀表板
    </div>
    <!-- 1. API 數據狀態區 (API 設定模組) -->
    <div class="flex flex-wrap gap-4 items-center text-sm">
      <div id="weather-status" class="flex items-center space-x-2 text-white jujube-gradient rounded-full px-4 py-2 shadow-lg">
        <div class="w-3 h-3 bg-white rounded-full animate-pulse"></div>
        <span>**氣候預警**：多雲/29°C</span>
      </div>
      <div id="pesticide-status" class="flex items-center space-x-2 text-gray-700 bg-green-100 rounded-full px-4 py-2 shadow-md">
        <div class="w-3 h-3 bg-green-500 rounded-full"></div>
        <span>**農藥檢測**：批次合格</span>
      </div>
    </div>
  </header>
  
  <!-- API 設定區塊 (隱藏在主標題下方，需要時彈出) -->
  <section id="api-setting-section" class="rural-tech-card p-6 mb-8 transition-all duration-300" style="display: none;">
      <h2 class="text-2xl font-bold mb-4 border-l-4 border-red-500 pl-3">🔑 Gemini API 設置與驗證</h2>
      <div class="flex flex-col md:flex-row gap-4">
        <input type="password" id="api-key-input" placeholder="請輸入您的 Gemini API Key" class="flex-grow p-3 border border-gray-300 rounded-lg focus:ring-red-500 focus:border-red-500 transition duration-200">
        <button id="validate-api-btn" class="jujube-red text-white py-3 px-4 rounded-lg hover:bg-red-700 transition duration-200 font-semibold shadow-md">
          驗證並啟用 AI 功能
        </button>
      </div>
      <p id="api-status-message" class="mt-3 text-sm text-gray-600">狀態：AI 功能尚未啟用。</p>
  </section>


  <!-- 主要內容區：分為左側 (選單/卡片) 和右側 (地圖) -->
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

    <!-- 左側欄：活動選單與品牌故事卡片區 -->
    <div class="lg:col-span-1 space-y-8">

      <!-- 2. 活動選擇模組 (Activity Menu) -->
      <section class="rural-tech-card p-6">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-2xl font-bold border-l-4 border-red-500 pl-3">📅 紅棗節活動選單</h2>
          <button onclick="toggleApiSettings()" class="text-sm text-red-500 hover:text-red-700 font-semibold">
            [API 設置]
          </button>
        </div>
        
        <div class="space-y-3">
            <!-- 模擬活動選單 -->
            <button class="activity-btn w-full text-left p-3 rounded-lg bg-red-100 transition duration-200 border-l-4 border-red-400 font-semibold text-gray-800" data-activity-id="event_01">
                🎉 紅棗節：採果體驗 (2025/07/20)
            </button>
            <button class="activity-btn w-full text-left p-3 rounded-lg bg-red-50 hover:bg-red-100 transition duration-200 border-l-4 border-gray-300 font-semibold text-gray-600" data-activity-id="event_02">
                ✍️ 紅棗食譜工作坊
            </button>
            <button class="activity-btn w-full text-left p-3 rounded-lg bg-red-50 hover:bg-red-100 transition duration-200 border-l-4 border-gray-300 font-semibold text-gray-600" data-activity-id="event_03">
                🌳 紅棗樹認養計畫
            </button>
        </div>
      </section>

      <!-- 3. 品牌故事卡片區 (Brand Story Card Area) -->
      <section class="rural-tech-card p-6">
        <h2 class="text-2xl font-bold mb-4 border-l-4 border-red-500 pl-3">🎙️ 品牌故事與農民訪談</h2>
        <!-- 卡片列表 (可滾動區塊) -->
        <div id="story-cards" class="space-y-4">
          <!-- 卡片將由 JavaScript 渲染 -->
        </div>
        <p id="story-filter-message" class="text-sm text-gray-500 mt-2">篩選狀態：顯示所有故事。</p>
      </section>
    </div>

    <!-- 右側欄：地圖展示區與 AI 互動區 -->
    <div class="lg:col-span-2 space-y-8">
      
      <!-- 品牌故事介紹與地圖模組 -->
      <section class="rural-tech-card p-6 h-[40vh] lg:h-[45vh] flex flex-col">
        <h2 class="text-2xl font-bold mb-4 border-l-4 border-red-500 pl-3">🗺️ 農園地圖與故事詳情</h2>
        
        <!-- 故事介紹區 -->
        <div id="story-details" class="mb-4 p-3 bg-red-50 rounded-lg border-l-4 border-red-400">
            <h3 class="text-xl font-bold jujube-text" id="detail-title">請點選左側卡片查看詳情</h3>
            <p class="text-gray-700 text-sm mt-1" id="detail-desc">點擊任一品牌故事卡片，此處將顯示農民介紹、食譜或溯源報告的簡要資訊。</p>
        </div>

        <!-- 模擬地圖畫面 (佔據剩餘空間) -->
        <div id="map-display" class="w-full h-full bg-gray-200 rounded-xl flex justify-center items-center relative overflow-hidden shadow-inner">
          <p class="text-gray-500 italic">
            [ 地圖/360° 環景 API 繪製區 ]
          </p>
          <!-- 模擬定位圖標 (初始位置) -->
          <div id="map-pin" class="absolute hidden text-red-600 map-pin-animate">
            <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd" />
            </svg>
          </div>
        </div>
      </section>

      <!-- AI 圖片生成與多媒體播放模組 -->
      <section class="rural-tech-card p-6 grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
          <h2 class="text-2xl font-bold mb-4 border-l-4 border-red-500 pl-3">🤖 AI 產品視覺化</h2>
          <div id="ai-output" class="w-full h-40 bg-gray-200 rounded-xl flex justify-center items-center mb-4 shadow-inner">
            <p class="text-gray-500 italic text-sm">AI 推薦產品圖片生成區</p>
          </div>
          <!-- 互動按鈕 -->
          <button id="generate-ai-btn" class="w-full jujube-gradient text-white py-3 px-4 rounded-lg hover:opacity-90 transition duration-200 font-semibold shadow-xl shadow-red-300/50" disabled>
            點擊生成 AI 產品圖片 (需 API Key)
          </button>
        </div>
        
        <div>
          <h2 class="text-2xl font-bold mb-4 border-l-4 border-red-500 pl-3">🎥 互動影片導覽</h2>
          <div id="video-player" class="w-full h-40 bg-gray-200 rounded-xl flex justify-center items-center mb-4 shadow-inner">
            <p class="text-gray-500 italic text-sm">多媒體影片播放區</p>
          </div>
          <!-- 互動按鈕 -->
          <button id="play-video-btn" class="w-full bg-green-600 text-white py-3 px-4 rounded-lg hover:bg-green-700 transition duration-200 font-semibold shadow-md">
            播放選中的多媒體導覽
          </button>
        </div>
      </section>

    </div>
  </div>
</div>

<!-- 浮動訊息提示框 (Toast) -->
<div id="toast-container" class="fixed bottom-5 right-5 space-y-2 z-50">
    <!-- 訊息將透過 JS 插入此處 -->
</div>

<!-- 互動邏輯 -->
<script>
  // 數據模型
  const storyData = {
    farmer_chen: {
      title: '陳伯伯的有機紅棗園',
      desc: '陳伯伯堅持了二十年的有機農法，確保每顆紅棗的天然甜度與安全。他的農園是公館最古老的紅棗園之一。',
      lat: 24.4930, lng: 120.8060,
      tags: ['農民故事', '有機', '溯源'],
      relatedActivity: 'event_01', // 採果體驗
    },
    ugc_recipe: {
      title: '紅棗燉雞湯食譜推薦',
      desc: '一位熱心消費者分享的獨家暖心紅棗雞湯食譜，包含詳細的烹飪步驟與多媒體影片導覽連結。',
      lat: 24.5000, lng: 120.8200,
      tags: ['UGC/多媒體', '食譜'],
      relatedActivity: 'event_02', // 食譜工作坊
    },
    trace_report: {
      title: '紅棗溯源報告：品質保證',
      desc: '點擊查看最新的紅棗批次溯源報告，從生長、採收到檢驗的完整數據，讓您安心選購。',
      lat: 24.4850, lng: 120.8120,
      tags: ['AI/溯源數據', '品質'],
      relatedActivity: 'event_03', // 認養計畫
    }
  };

  // 狀態變數
  let currentActivityFilter = 'event_01'; // 預設篩選第一個活動
  let isApiVerified = false;

  // DOM 元素
  const apiSettingSection = document.getElementById('api-setting-section');
  const apiKeyInput = document.getElementById('api-key-input');
  const validateApiBtn = document.getElementById('validate-api-btn');
  const apiStatusMessage = document.getElementById('api-status-message');
  const storyCardsContainer = document.getElementById('story-cards');
  const mapPin = document.getElementById('map-pin');
  const detailTitle = document.getElementById('detail-title');
  const detailDesc = document.getElementById('detail-desc');
  const generateAiBtn = document.getElementById('generate-ai-btn');
  const playVideoBtn = document.getElementById('play-video-btn');
  const storyFilterMessage = document.getElementById('story-filter-message');

  // --- 訊息提示功能 (取代 alert) ---
  function showMessage(message, type = 'info') {
    const toastContainer = document.getElementById('toast-container');
    const toast = document.createElement('div');
    
    let baseClasses = 'p-4 rounded-xl shadow-lg transition-all duration-300 transform translate-x-0';
    let colorClasses = '';

    switch (type) {
      case 'success':
        colorClasses = 'bg-green-500 text-white';
        break;
      case 'error':
        colorClasses = 'bg-red-500 text-white';
        break;
      case 'warning':
        colorClasses = 'bg-yellow-500 text-white';
        break;
      case 'info':
      default:
        colorClasses = 'bg-gray-700 text-white';
        break;
    }
    
    toast.className = `${baseClasses} ${colorClasses}`;
    toast.textContent = message;
    
    // 插入並顯示
    toastContainer.prepend(toast);
    
    // 3秒後隱藏並移除
    setTimeout(() => {
      toast.classList.add('opacity-0');
      setTimeout(() => toast.remove(), 300);
    }, 4000);
  }

  // --- 1. API 設定模組 (API Key 驗證) ---

  function toggleApiSettings() {
    apiSettingSection.style.display = apiSettingSection.style.display === 'none' ? 'block' : 'none';
  }

  validateApiBtn.addEventListener('click', () => {
    const key = apiKeyInput.value.trim();
    if (key.length > 10) { // 簡單模擬驗證
      isApiVerified = true;
      apiStatusMessage.className = 'mt-3 text-sm text-green-600 font-semibold';
      apiStatusMessage.textContent = '狀態：Gemini API 驗證成功！AI 功能已啟用。';
      generateAiBtn.disabled = false;
      generateAiBtn.textContent = '點擊生成 AI 產品圖片';
      generateAiBtn.classList.remove('opacity-50');
      showMessage('API Key 驗證成功！', 'success');
      toggleApiSettings();
    } else {
      isApiVerified = false;
      apiStatusMessage.className = 'mt-3 text-sm text-red-600';
      apiStatusMessage.textContent = '狀態：API Key 無效，請重新輸入。';
      generateAiBtn.disabled = true;
      showMessage('API Key 格式錯誤，請檢查。', 'error');
    }
  });

  // --- 2. 品牌故事卡片渲染與篩選 ---

  function renderStoryCards(filterId) {
    storyCardsContainer.innerHTML = ''; // 清空舊卡片
    let storiesToDisplay = Object.entries(storyData);
    let activityText = '';

    if (filterId && filterId !== 'all') {
      storiesToDisplay = storiesToDisplay.filter(([id, story]) => story.relatedActivity === filterId);
      const activityBtn = document.querySelector(`.activity-btn[data-activity-id="${filterId}"]`);
      activityText = activityBtn ? activityBtn.textContent.trim() : '特定活動';
      storyFilterMessage.textContent = `篩選狀態：與「${activityText}」相關的故事。`;
    } else {
      storyFilterMessage.textContent = `篩選狀態：顯示所有故事。`;
    }

    if (storiesToDisplay.length === 0) {
      storyCardsContainer.innerHTML = '<p class="text-gray-500 italic p-4">此活動暫無相關品牌故事。</p>';
    }

    storiesToDisplay.forEach(([id, story]) => {
      const tagHtml = story.tags.map(tag => `<span class="text-xs text-red-700 bg-red-200 px-2 py-0.5 rounded-full mt-2 inline-block mr-1">${tag}</span>`).join('');
      
      const card = document.createElement('div');
      card.className = `story-card p-4 rounded-xl bg-gray-50 hover:bg-red-50 transition duration-200 cursor-pointer border border-gray-200`;
      card.setAttribute('data-story-id', id);
      card.setAttribute('data-lat', story.lat);
      card.setAttribute('data-lng', story.lng);
      card.innerHTML = `
        <h4 class="font-semibold text-lg jujube-text">${story.title}</h4>
        <p class="text-sm text-gray-600 line-clamp-2">${story.desc}</p>
        ${tagHtml}
      `;
      card.addEventListener('click', handleStoryClick);
      storyCardsContainer.appendChild(card);
    });
  }

  // 3. 點選活動顯示品牌故事
  document.querySelectorAll('.activity-btn').forEach(btn => {
      btn.addEventListener('click', (event) => {
          // 更新活動選單樣式
          document.querySelectorAll('.activity-btn').forEach(b => {
            b.classList.replace('border-red-400', 'border-gray-300');
            b.classList.replace('bg-red-100', 'bg-red-50');
            b.classList.replace('text-gray-800', 'text-gray-600');
          });
          event.currentTarget.classList.replace('border-gray-300', 'border-red-400');
          event.currentTarget.classList.replace('bg-red-50', 'bg-red-100');
          event.currentTarget.classList.replace('text-gray-600', 'text-gray-800');
          
          // 更新篩選器並渲染卡片
          currentActivityFilter = event.currentTarget.getAttribute('data-activity-id');
          renderStoryCards(currentActivityFilter);

          showMessage(`已切換活動篩選：${event.currentTarget.textContent.trim()}`, 'info');
      });
  });

  // --- 4. 點選故事後顯示介紹與地圖座標 ---

  function handleStoryClick(event) {
    const card = event.currentTarget;
    const storyId = card.getAttribute('data-story-id');
    const lat = card.getAttribute('data-lat');
    const lng = card.getAttribute('data-lng');
    const story = storyData[storyId];

    // 更新卡片激活樣式
    document.querySelectorAll('.story-card').forEach(c => c.classList.remove('border-red-500', 'bg-red-100'));
    card.classList.add('border-red-500', 'bg-red-100');

    // 更新詳情區
    detailTitle.textContent = story.title;
    detailDesc.textContent = story.desc;
    
    // 模擬地圖更新 (定位圖標移動和顯示)
    // 實際應用中，需要將 lat/lng 傳遞給地圖 API
    mapPin.style.display = 'block'; 
    
    showMessage(`正在定位 [${lat}, ${lng}]，地圖顯示 ${story.title} 的位置。`, 'success');
  }

  // --- 5. 點擊按鈕生成圖片與影片播放 ---

  generateAiBtn.addEventListener('click', () => {
    if (!isApiVerified) {
        showMessage('請先驗證 Gemini API Key 才能使用 AI 圖片生成功能。', 'error');
        return;
    }
    
    const aiOutput = document.getElementById('ai-output');
    aiOutput.innerHTML = '<div class="animate-spin rounded-full h-8 w-8 border-b-2 border-red-500"></div><p class="text-red-500 ml-3">AI 正在為您生成圖片...</p>';
    generateAiBtn.disabled = true;

    // 模擬 API 呼叫延遲
    setTimeout(() => {
      // 模擬 AI 生成圖片
      const imageUrl = `https://placehold.co/300x150/d62828/ffffff?text=AI+Generated+Jujube+Product`;
      aiOutput.innerHTML = `<img src="${imageUrl}" alt="AI Generated Product Image" class="w-full h-full object-cover rounded-xl shadow-lg border-4 border-white">`;
      generateAiBtn.disabled = false;
      showMessage('AI 產品圖片生成成功！', 'success');
    }, 2500);
  });

  playVideoBtn.addEventListener('click', () => {
    const videoPlayer = document.getElementById('video-player');
    
    // 播放模擬的紅棗影片（使用 Rick Roll 連結作為佔位符）
    videoPlayer.innerHTML = `
      <iframe width="100%" height="100%" src="https://www.youtube.com/embed/dQw4w9WgXcQ?autoplay=1" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen class="rounded-xl"></iframe>
    `;
    showMessage('多媒體影片導覽已開始播放！', 'info');
  });


  // --- 初始化 ---
  document.addEventListener('DOMContentLoaded', () => {
    // 初始渲染卡片 (根據預設 filterId)
    renderStoryCards(currentActivityFilter);
  });
</script>

