<H1>å…¬é¤¨é„‰ç´…æ£—å“ç‰Œç®¡ç†å®¶</H1>
<!--
  ä¸»é¡Œï¼šå…¬é¤¨ç´…æ£—ç”¢æ¥­æ¨å»£ç¶²ç«™
  è¨­è¨ˆé¢¨æ ¼ï¼šè‡ªç„¶é„‰æ‘ç§‘æŠ€æ„Ÿ (Natural Rural Tech-feel)ï¼Œç´…æ£—æš–è‰²èª¿ã€‚
  çµæ§‹ï¼šå–®é  HTMLï¼Œä½¿ç”¨ Tailwind CSS é€²è¡ŒéŸ¿æ‡‰å¼å¸ƒå±€ã€‚
  æ ¸å¿ƒå€å¡Šï¼šæ¨™é¡Œå€/APIç‹€æ…‹ã€æ´»å‹•é¸å–®ã€å“ç‰Œæ•…äº‹å¡ç‰‡ã€è¾²åœ’åœ°åœ–ã€‚
  äº’å‹•åŠŸèƒ½ï¼šAPI Key é©—è­‰ã€æ´»å‹•ç¯©é¸ã€æ•…äº‹å¡ç‰‡å®šä½ã€AI/å½±ç‰‡æŒ‰éˆ•æ¨¡æ“¬ã€‚
-->
<script src="https://cdn.tailwindcss.com"></script>
<style>
  /* è¼‰å…¥ Inter å­—é«”ä¸¦è¨­å®šæŸ”å’Œã€è‡ªç„¶çš„èƒŒæ™¯ */
  body {
    font-family: 'Inter', sans-serif;
    /* æŸ”å’Œçš„æ·ºç±³è‰²/å¤§åœ°è‰²æ¼¸å±¤èƒŒæ™¯ */
    background-color: #f7f7f0;
    background-image: linear-gradient(135deg, #fefefe 0%, #f1f5f9 100%);
    color: #1e293b; /* æ·±è‰²æ–‡å­— */
    min-height: 100vh;
    padding: 1.5rem 1rem;
  }

  /* æ ¸å¿ƒå¡ç‰‡æ¨£å¼ï¼šæŸ”å’Œé™°å½±ã€åœ“è§’é‚Šæ¡†ã€æº«æš–è‰²èª¿ */
  .rural-tech-card {
    background-color: #ffffff; /* ç™½è‰²èƒŒæ™¯ */
    border: 1px solid #e5e5e5; /* æ·ºç°é‚Šæ¡† */
    border-radius: 1.5rem; /* æ›´å¤§çš„åœ“è§’ */
    box-shadow: 0 10px 30px -5px rgba(0, 0, 0, 0.08), 0 5px 15px -5px rgba(0, 0, 0, 0.04); /* æŸ”å’Œæ·±é™°å½± */
    transition: all 0.3s ease;
  }

  .rural-tech-card:hover {
    box-shadow: 0 15px 35px -8px rgba(214, 40, 40, 0.2), 0 8px 20px -5px rgba(214, 40, 40, 0.1); /* ç´…æ£—ç´…çš„æŸ”å’Œé™°å½± */
    transform: translateY(-2px);
  }

  /* ç´…æ£—è‰²èª¿ */
  .jujube-red {
    background-color: #D62828; /* æ·±ç´…æ£—è‰² */
  }
  .jujube-text {
    color: #D62828;
  }
  .jujube-gradient {
    background-image: linear-gradient(to right, #D62828, #E76F51); /* ç´…æ£—æ¼¸å±¤ */
  }

  /* ç¢ºä¿å¡ç‰‡å€å¯ä»¥å‚ç›´æ»¾å‹• */
  #story-cards {
    max-height: calc(100vh - 430px); /* èª¿æ•´é«˜åº¦ä»¥å®¹ç´ API è¨­å®šå€ */
    overflow-y: auto;
  }

  /* æ»¾å‹•æ¢æ¨£å¼ */
  #story-cards::-webkit-scrollbar {
    width: 6px;
  }

  #story-cards::-webkit-scrollbar-thumb {
    background: #fca5a5; /* æ·ºç´…æ£—è‰² */
    border-radius: 10px;
  }

  /* åœ°åœ–å®šä½é»å‹•ç•« */
  .map-pin-animate {
    animation: bounce-pin 1.5s infinite;
  }

  @keyframes bounce-pin {
    0%, 20%, 50%, 80%, 100% {
      transform: translateY(0);
    }
    40% {
      transform: translateY(-30px);
    }
    60% {
      transform: translateY(-15px);
    }
  }
</style>

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- æ•´å€‹ç¶²ç«™çš„ä¸­å¤®å®¹å™¨ (container) -->
<div id="main-container" class="max-w-7xl mx-auto p-4 md:p-8">

  <!-- æ¨™é¡Œå€ (Header/Title) -->
  <header class="rural-tech-card mb-8 p-6 flex flex-col md:flex-row justify-between items-start md:items-center bg-white">
    <div class="text-3xl md:text-4xl font-extrabold tracking-tight mb-3 md:mb-0">
      <span class="jujube-text">ğŸ’ æ£—ç´…å…¬é¤¨</span>ï¼šæ•¸ä½è½‰å‹å„€è¡¨æ¿
    </div>
    <!-- 1. API æ•¸æ“šç‹€æ…‹å€ (API è¨­å®šæ¨¡çµ„) -->
    <div class="flex flex-wrap gap-4 items-center text-sm">
      <div id="weather-status" class="flex items-center space-x-2 text-white jujube-gradient rounded-full px-4 py-2 shadow-lg">
        <div class="w-3 h-3 bg-white rounded-full animate-pulse"></div>
        <span>**æ°£å€™é è­¦**ï¼šå¤šé›²/29Â°C</span>
      </div>
      <div id="pesticide-status" class="flex items-center space-x-2 text-gray-700 bg-green-100 rounded-full px-4 py-2 shadow-md">
        <div class="w-3 h-3 bg-green-500 rounded-full"></div>
        <span>**è¾²è—¥æª¢æ¸¬**ï¼šæ‰¹æ¬¡åˆæ ¼</span>
      </div>
    </div>
  </header>
  
  <!-- API è¨­å®šå€å¡Š (éš±è—åœ¨ä¸»æ¨™é¡Œä¸‹æ–¹ï¼Œéœ€è¦æ™‚å½ˆå‡º) -->
  <section id="api-setting-section" class="rural-tech-card p-6 mb-8 transition-all duration-300" style="display: none;">
      <h2 class="text-2xl font-bold mb-4 border-l-4 border-red-500 pl-3">ğŸ”‘ Gemini API è¨­ç½®èˆ‡é©—è­‰</h2>
      <div class="flex flex-col md:flex-row gap-4">
        <input type="password" id="api-key-input" placeholder="è«‹è¼¸å…¥æ‚¨çš„ Gemini API Key" class="flex-grow p-3 border border-gray-300 rounded-lg focus:ring-red-500 focus:border-red-500 transition duration-200">
        <button id="validate-api-btn" class="jujube-red text-white py-3 px-4 rounded-lg hover:bg-red-700 transition duration-200 font-semibold shadow-md">
          é©—è­‰ä¸¦å•Ÿç”¨ AI åŠŸèƒ½
        </button>
      </div>
      <p id="api-status-message" class="mt-3 text-sm text-gray-600">ç‹€æ…‹ï¼šAI åŠŸèƒ½å°šæœªå•Ÿç”¨ã€‚</p>
  </section>


  <!-- ä¸»è¦å…§å®¹å€ï¼šåˆ†ç‚ºå·¦å´ (é¸å–®/å¡ç‰‡) å’Œå³å´ (åœ°åœ–) -->
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

    <!-- å·¦å´æ¬„ï¼šæ´»å‹•é¸å–®èˆ‡å“ç‰Œæ•…äº‹å¡ç‰‡å€ -->
    <div class="lg:col-span-1 space-y-8">

      <!-- 2. æ´»å‹•é¸æ“‡æ¨¡çµ„ (Activity Menu) -->
      <section class="rural-tech-card p-6">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-2xl font-bold border-l-4 border-red-500 pl-3">ğŸ“… ç´…æ£—ç¯€æ´»å‹•é¸å–®</h2>
          <button onclick="toggleApiSettings()" class="text-sm text-red-500 hover:text-red-700 font-semibold">
            [API è¨­ç½®]
          </button>
        </div>
        
        <div class="space-y-3">
            <!-- æ¨¡æ“¬æ´»å‹•é¸å–® -->
            <button class="activity-btn w-full text-left p-3 rounded-lg bg-red-100 transition duration-200 border-l-4 border-red-400 font-semibold text-gray-800" data-activity-id="event_01">
                ğŸ‰ ç´…æ£—ç¯€ï¼šæ¡æœé«”é©— (2025/07/20)
            </button>
            <button class="activity-btn w-full text-left p-3 rounded-lg bg-red-50 hover:bg-red-100 transition duration-200 border-l-4 border-gray-300 font-semibold text-gray-600" data-activity-id="event_02">
                âœï¸ ç´…æ£—é£Ÿè­œå·¥ä½œåŠ
            </button>
            <button class="activity-btn w-full text-left p-3 rounded-lg bg-red-50 hover:bg-red-100 transition duration-200 border-l-4 border-gray-300 font-semibold text-gray-600" data-activity-id="event_03">
                ğŸŒ³ ç´…æ£—æ¨¹èªé¤Šè¨ˆç•«
            </button>
        </div>
      </section>

      <!-- 3. å“ç‰Œæ•…äº‹å¡ç‰‡å€ (Brand Story Card Area) -->
      <section class="rural-tech-card p-6">
        <h2 class="text-2xl font-bold mb-4 border-l-4 border-red-500 pl-3">ğŸ™ï¸ å“ç‰Œæ•…äº‹èˆ‡è¾²æ°‘è¨ªè«‡</h2>
        <!-- å¡ç‰‡åˆ—è¡¨ (å¯æ»¾å‹•å€å¡Š) -->
        <div id="story-cards" class="space-y-4">
          <!-- å¡ç‰‡å°‡ç”± JavaScript æ¸²æŸ“ -->
        </div>
        <p id="story-filter-message" class="text-sm text-gray-500 mt-2">ç¯©é¸ç‹€æ…‹ï¼šé¡¯ç¤ºæ‰€æœ‰æ•…äº‹ã€‚</p>
      </section>
    </div>

    <!-- å³å´æ¬„ï¼šåœ°åœ–å±•ç¤ºå€èˆ‡ AI äº’å‹•å€ -->
    <div class="lg:col-span-2 space-y-8">
      
      <!-- å“ç‰Œæ•…äº‹ä»‹ç´¹èˆ‡åœ°åœ–æ¨¡çµ„ -->
      <section class="rural-tech-card p-6 h-[40vh] lg:h-[45vh] flex flex-col">
        <h2 class="text-2xl font-bold mb-4 border-l-4 border-red-500 pl-3">ğŸ—ºï¸ è¾²åœ’åœ°åœ–èˆ‡æ•…äº‹è©³æƒ…</h2>
        
        <!-- æ•…äº‹ä»‹ç´¹å€ -->
        <div id="story-details" class="mb-4 p-3 bg-red-50 rounded-lg border-l-4 border-red-400">
            <h3 class="text-xl font-bold jujube-text" id="detail-title">è«‹é»é¸å·¦å´å¡ç‰‡æŸ¥çœ‹è©³æƒ…</h3>
            <p class="text-gray-700 text-sm mt-1" id="detail-desc">é»æ“Šä»»ä¸€å“ç‰Œæ•…äº‹å¡ç‰‡ï¼Œæ­¤è™•å°‡é¡¯ç¤ºè¾²æ°‘ä»‹ç´¹ã€é£Ÿè­œæˆ–æº¯æºå ±å‘Šçš„ç°¡è¦è³‡è¨Šã€‚</p>
        </div>

        <!-- æ¨¡æ“¬åœ°åœ–ç•«é¢ (ä½”æ“šå‰©é¤˜ç©ºé–“) -->
        <div id="map-display" class="w-full h-full bg-gray-200 rounded-xl flex justify-center items-center relative overflow-hidden shadow-inner">
          <p class="text-gray-500 italic">
            [ åœ°åœ–/360Â° ç’°æ™¯ API ç¹ªè£½å€ ]
          </p>
          <!-- æ¨¡æ“¬å®šä½åœ–æ¨™ (åˆå§‹ä½ç½®) -->
          <div id="map-pin" class="absolute hidden text-red-600 map-pin-animate">
            <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd" />
            </svg>
          </div>
        </div>
      </section>

      <!-- AI åœ–ç‰‡ç”Ÿæˆèˆ‡å¤šåª’é«”æ’­æ”¾æ¨¡çµ„ -->
      <section class="rural-tech-card p-6 grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
          <h2 class="text-2xl font-bold mb-4 border-l-4 border-red-500 pl-3">ğŸ¤– AI ç”¢å“è¦–è¦ºåŒ–</h2>
          <div id="ai-output" class="w-full h-40 bg-gray-200 rounded-xl flex justify-center items-center mb-4 shadow-inner">
            <p class="text-gray-500 italic text-sm">AI æ¨è–¦ç”¢å“åœ–ç‰‡ç”Ÿæˆå€</p>
          </div>
          <!-- äº’å‹•æŒ‰éˆ• -->
          <button id="generate-ai-btn" class="w-full jujube-gradient text-white py-3 px-4 rounded-lg hover:opacity-90 transition duration-200 font-semibold shadow-xl shadow-red-300/50" disabled>
            é»æ“Šç”Ÿæˆ AI ç”¢å“åœ–ç‰‡ (éœ€ API Key)
          </button>
        </div>
        
        <div>
          <h2 class="text-2xl font-bold mb-4 border-l-4 border-red-500 pl-3">ğŸ¥ äº’å‹•å½±ç‰‡å°è¦½</h2>
          <div id="video-player" class="w-full h-40 bg-gray-200 rounded-xl flex justify-center items-center mb-4 shadow-inner">
            <p class="text-gray-500 italic text-sm">å¤šåª’é«”å½±ç‰‡æ’­æ”¾å€</p>
          </div>
          <!-- äº’å‹•æŒ‰éˆ• -->
          <button id="play-video-btn" class="w-full bg-green-600 text-white py-3 px-4 rounded-lg hover:bg-green-700 transition duration-200 font-semibold shadow-md">
            æ’­æ”¾é¸ä¸­çš„å¤šåª’é«”å°è¦½
          </button>
        </div>
      </section>

    </div>
  </div>
</div>

<!-- æµ®å‹•è¨Šæ¯æç¤ºæ¡† (Toast) -->
<div id="toast-container" class="fixed bottom-5 right-5 space-y-2 z-50">
    <!-- è¨Šæ¯å°‡é€é JS æ’å…¥æ­¤è™• -->
</div>

<!-- äº’å‹•é‚è¼¯ -->
<script>
  // æ•¸æ“šæ¨¡å‹
  const storyData = {
    farmer_chen: {
      title: 'é™³ä¼¯ä¼¯çš„æœ‰æ©Ÿç´…æ£—åœ’',
      desc: 'é™³ä¼¯ä¼¯å …æŒäº†äºŒåå¹´çš„æœ‰æ©Ÿè¾²æ³•ï¼Œç¢ºä¿æ¯é¡†ç´…æ£—çš„å¤©ç„¶ç”œåº¦èˆ‡å®‰å…¨ã€‚ä»–çš„è¾²åœ’æ˜¯å…¬é¤¨æœ€å¤è€çš„ç´…æ£—åœ’ä¹‹ä¸€ã€‚',
      lat: 24.4930, lng: 120.8060,
      tags: ['è¾²æ°‘æ•…äº‹', 'æœ‰æ©Ÿ', 'æº¯æº'],
      relatedActivity: 'event_01', // æ¡æœé«”é©—
    },
    ugc_recipe: {
      title: 'ç´…æ£—ç‡‰é›æ¹¯é£Ÿè­œæ¨è–¦',
      desc: 'ä¸€ä½ç†±å¿ƒæ¶ˆè²»è€…åˆ†äº«çš„ç¨å®¶æš–å¿ƒç´…æ£—é›æ¹¯é£Ÿè­œï¼ŒåŒ…å«è©³ç´°çš„çƒ¹é£ªæ­¥é©Ÿèˆ‡å¤šåª’é«”å½±ç‰‡å°è¦½é€£çµã€‚',
      lat: 24.5000, lng: 120.8200,
      tags: ['UGC/å¤šåª’é«”', 'é£Ÿè­œ'],
      relatedActivity: 'event_02', // é£Ÿè­œå·¥ä½œåŠ
    },
    trace_report: {
      title: 'ç´…æ£—æº¯æºå ±å‘Šï¼šå“è³ªä¿è­‰',
      desc: 'é»æ“ŠæŸ¥çœ‹æœ€æ–°çš„ç´…æ£—æ‰¹æ¬¡æº¯æºå ±å‘Šï¼Œå¾ç”Ÿé•·ã€æ¡æ”¶åˆ°æª¢é©—çš„å®Œæ•´æ•¸æ“šï¼Œè®“æ‚¨å®‰å¿ƒé¸è³¼ã€‚',
      lat: 24.4850, lng: 120.8120,
      tags: ['AI/æº¯æºæ•¸æ“š', 'å“è³ª'],
      relatedActivity: 'event_03', // èªé¤Šè¨ˆç•«
    }
  };

  // ç‹€æ…‹è®Šæ•¸
  let currentActivityFilter = 'event_01'; // é è¨­ç¯©é¸ç¬¬ä¸€å€‹æ´»å‹•
  let isApiVerified = false;

  // DOM å…ƒç´ 
  const apiSettingSection = document.getElementById('api-setting-section');
  const apiKeyInput = document.getElementById('api-key-input');
  const validateApiBtn = document.getElementById('validate-api-btn');
  const apiStatusMessage = document.getElementById('api-status-message');
  const storyCardsContainer = document.getElementById('story-cards');
  const mapPin = document.getElementById('map-pin');
  const detailTitle = document.getElementById('detail-title');
  const detailDesc = document.getElementById('detail-desc');
  const generateAiBtn = document.getElementById('generate-ai-btn');
  const playVideoBtn = document.getElementById('play-video-btn');
  const storyFilterMessage = document.getElementById('story-filter-message');

  // --- è¨Šæ¯æç¤ºåŠŸèƒ½ (å–ä»£ alert) ---
  function showMessage(message, type = 'info') {
    const toastContainer = document.getElementById('toast-container');
    const toast = document.createElement('div');
    
    let baseClasses = 'p-4 rounded-xl shadow-lg transition-all duration-300 transform translate-x-0';
    let colorClasses = '';

    switch (type) {
      case 'success':
        colorClasses = 'bg-green-500 text-white';
        break;
      case 'error':
        colorClasses = 'bg-red-500 text-white';
        break;
      case 'warning':
        colorClasses = 'bg-yellow-500 text-white';
        break;
      case 'info':
      default:
        colorClasses = 'bg-gray-700 text-white';
        break;
    }
    
    toast.className = `${baseClasses} ${colorClasses}`;
    toast.textContent = message;
    
    // æ’å…¥ä¸¦é¡¯ç¤º
    toastContainer.prepend(toast);
    
    // 3ç§’å¾Œéš±è—ä¸¦ç§»é™¤
    setTimeout(() => {
      toast.classList.add('opacity-0');
      setTimeout(() => toast.remove(), 300);
    }, 4000);
  }

  // --- 1. API è¨­å®šæ¨¡çµ„ (API Key é©—è­‰) ---

  function toggleApiSettings() {
    apiSettingSection.style.display = apiSettingSection.style.display === 'none' ? 'block' : 'none';
  }

  validateApiBtn.addEventListener('click', () => {
    const key = apiKeyInput.value.trim();
    if (key.length > 10) { // ç°¡å–®æ¨¡æ“¬é©—è­‰
      isApiVerified = true;
      apiStatusMessage.className = 'mt-3 text-sm text-green-600 font-semibold';
      apiStatusMessage.textContent = 'ç‹€æ…‹ï¼šGemini API é©—è­‰æˆåŠŸï¼AI åŠŸèƒ½å·²å•Ÿç”¨ã€‚';
      generateAiBtn.disabled = false;
      generateAiBtn.textContent = 'é»æ“Šç”Ÿæˆ AI ç”¢å“åœ–ç‰‡';
      generateAiBtn.classList.remove('opacity-50');
      showMessage('API Key é©—è­‰æˆåŠŸï¼', 'success');
      toggleApiSettings();
    } else {
      isApiVerified = false;
      apiStatusMessage.className = 'mt-3 text-sm text-red-600';
      apiStatusMessage.textContent = 'ç‹€æ…‹ï¼šAPI Key ç„¡æ•ˆï¼Œè«‹é‡æ–°è¼¸å…¥ã€‚';
      generateAiBtn.disabled = true;
      showMessage('API Key æ ¼å¼éŒ¯èª¤ï¼Œè«‹æª¢æŸ¥ã€‚', 'error');
    }
  });

  // --- 2. å“ç‰Œæ•…äº‹å¡ç‰‡æ¸²æŸ“èˆ‡ç¯©é¸ ---

  function renderStoryCards(filterId) {
    storyCardsContainer.innerHTML = ''; // æ¸…ç©ºèˆŠå¡ç‰‡
    let storiesToDisplay = Object.entries(storyData);
    let activityText = '';

    if (filterId && filterId !== 'all') {
      storiesToDisplay = storiesToDisplay.filter(([id, story]) => story.relatedActivity === filterId);
      const activityBtn = document.querySelector(`.activity-btn[data-activity-id="${filterId}"]`);
      activityText = activityBtn ? activityBtn.textContent.trim() : 'ç‰¹å®šæ´»å‹•';
      storyFilterMessage.textContent = `ç¯©é¸ç‹€æ…‹ï¼šèˆ‡ã€Œ${activityText}ã€ç›¸é—œçš„æ•…äº‹ã€‚`;
    } else {
      storyFilterMessage.textContent = `ç¯©é¸ç‹€æ…‹ï¼šé¡¯ç¤ºæ‰€æœ‰æ•…äº‹ã€‚`;
    }

    if (storiesToDisplay.length === 0) {
      storyCardsContainer.innerHTML = '<p class="text-gray-500 italic p-4">æ­¤æ´»å‹•æš«ç„¡ç›¸é—œå“ç‰Œæ•…äº‹ã€‚</p>';
    }

    storiesToDisplay.forEach(([id, story]) => {
      const tagHtml = story.tags.map(tag => `<span class="text-xs text-red-700 bg-red-200 px-2 py-0.5 rounded-full mt-2 inline-block mr-1">${tag}</span>`).join('');
      
      const card = document.createElement('div');
      card.className = `story-card p-4 rounded-xl bg-gray-50 hover:bg-red-50 transition duration-200 cursor-pointer border border-gray-200`;
      card.setAttribute('data-story-id', id);
      card.setAttribute('data-lat', story.lat);
      card.setAttribute('data-lng', story.lng);
      card.innerHTML = `
        <h4 class="font-semibold text-lg jujube-text">${story.title}</h4>
        <p class="text-sm text-gray-600 line-clamp-2">${story.desc}</p>
        ${tagHtml}
      `;
      card.addEventListener('click', handleStoryClick);
      storyCardsContainer.appendChild(card);
    });
  }

  // 3. é»é¸æ´»å‹•é¡¯ç¤ºå“ç‰Œæ•…äº‹
  document.querySelectorAll('.activity-btn').forEach(btn => {
      btn.addEventListener('click', (event) => {
          // æ›´æ–°æ´»å‹•é¸å–®æ¨£å¼
          document.querySelectorAll('.activity-btn').forEach(b => {
            b.classList.replace('border-red-400', 'border-gray-300');
            b.classList.replace('bg-red-100', 'bg-red-50');
            b.classList.replace('text-gray-800', 'text-gray-600');
          });
          event.currentTarget.classList.replace('border-gray-300', 'border-red-400');
          event.currentTarget.classList.replace('bg-red-50', 'bg-red-100');
          event.currentTarget.classList.replace('text-gray-600', 'text-gray-800');
          
          // æ›´æ–°ç¯©é¸å™¨ä¸¦æ¸²æŸ“å¡ç‰‡
          currentActivityFilter = event.currentTarget.getAttribute('data-activity-id');
          renderStoryCards(currentActivityFilter);

          showMessage(`å·²åˆ‡æ›æ´»å‹•ç¯©é¸ï¼š${event.currentTarget.textContent.trim()}`, 'info');
      });
  });

  // --- 4. é»é¸æ•…äº‹å¾Œé¡¯ç¤ºä»‹ç´¹èˆ‡åœ°åœ–åº§æ¨™ ---

  function handleStoryClick(event) {
    const card = event.currentTarget;
    const storyId = card.getAttribute('data-story-id');
    const lat = card.getAttribute('data-lat');
    const lng = card.getAttribute('data-lng');
    const story = storyData[storyId];

    // æ›´æ–°å¡ç‰‡æ¿€æ´»æ¨£å¼
    document.querySelectorAll('.story-card').forEach(c => c.classList.remove('border-red-500', 'bg-red-100'));
    card.classList.add('border-red-500', 'bg-red-100');

    // æ›´æ–°è©³æƒ…å€
    detailTitle.textContent = story.title;
    detailDesc.textContent = story.desc;
    
    // æ¨¡æ“¬åœ°åœ–æ›´æ–° (å®šä½åœ–æ¨™ç§»å‹•å’Œé¡¯ç¤º)
    // å¯¦éš›æ‡‰ç”¨ä¸­ï¼Œéœ€è¦å°‡ lat/lng å‚³éçµ¦åœ°åœ– API
    mapPin.style.display = 'block'; 
    
    showMessage(`æ­£åœ¨å®šä½ [${lat}, ${lng}]ï¼Œåœ°åœ–é¡¯ç¤º ${story.title} çš„ä½ç½®ã€‚`, 'success');
  }

  // --- 5. é»æ“ŠæŒ‰éˆ•ç”Ÿæˆåœ–ç‰‡èˆ‡å½±ç‰‡æ’­æ”¾ ---

  generateAiBtn.addEventListener('click', () => {
    if (!isApiVerified) {
        showMessage('è«‹å…ˆé©—è­‰ Gemini API Key æ‰èƒ½ä½¿ç”¨ AI åœ–ç‰‡ç”ŸæˆåŠŸèƒ½ã€‚', 'error');
        return;
    }
    
    const aiOutput = document.getElementById('ai-output');
    aiOutput.innerHTML = '<div class="animate-spin rounded-full h-8 w-8 border-b-2 border-red-500"></div><p class="text-red-500 ml-3">AI æ­£åœ¨ç‚ºæ‚¨ç”Ÿæˆåœ–ç‰‡...</p>';
    generateAiBtn.disabled = true;

    // æ¨¡æ“¬ API å‘¼å«å»¶é²
    setTimeout(() => {
      // æ¨¡æ“¬ AI ç”Ÿæˆåœ–ç‰‡
      const imageUrl = `https://placehold.co/300x150/d62828/ffffff?text=AI+Generated+Jujube+Product`;
      aiOutput.innerHTML = `<img src="${imageUrl}" alt="AI Generated Product Image" class="w-full h-full object-cover rounded-xl shadow-lg border-4 border-white">`;
      generateAiBtn.disabled = false;
      showMessage('AI ç”¢å“åœ–ç‰‡ç”ŸæˆæˆåŠŸï¼', 'success');
    }, 2500);
  });

  playVideoBtn.addEventListener('click', () => {
    const videoPlayer = document.getElementById('video-player');
    
    // æ’­æ”¾æ¨¡æ“¬çš„ç´…æ£—å½±ç‰‡ï¼ˆä½¿ç”¨ Rick Roll é€£çµä½œç‚ºä½”ä½ç¬¦ï¼‰
    videoPlayer.innerHTML = `
      <iframe width="100%" height="100%" src="https://www.youtube.com/embed/dQw4w9WgXcQ?autoplay=1" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen class="rounded-xl"></iframe>
    `;
    showMessage('å¤šåª’é«”å½±ç‰‡å°è¦½å·²é–‹å§‹æ’­æ”¾ï¼', 'info');
  });


  // --- åˆå§‹åŒ– ---
  document.addEventListener('DOMContentLoaded', () => {
    // åˆå§‹æ¸²æŸ“å¡ç‰‡ (æ ¹æ“šé è¨­ filterId)
    renderStoryCards(currentActivityFilter);
  });
</script>

